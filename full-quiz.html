<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ ã‚¯ã‚¤ã‚ºãƒ»ã‚ªã‚¿ã‚¯çŸ¥è­˜ã®æ³‰ - å®Œå…¨ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px;
            max-width: 700px;
            width: 100%;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .loading {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .data-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
        }

        .button-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 10px;
            padding: 15px 25px;
            color: white;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .random-button {
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.5);
        }

        .difficulty-section {
            margin: 20px 0;
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .difficulty-button {
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-button:hover {
            border-color: rgba(255, 215, 0, 0.5);
        }

        .difficulty-button.selected {
            border-color: rgba(255, 215, 0, 0.8);
            background: rgba(255, 215, 0, 0.2);
        }

        .quiz-header {
            margin-bottom: 30px;
        }

        .progress {
            font-size: 1.1em;
            opacity: 0.8;
            margin-bottom: 10px;
        }

        .question-meta {
            font-size: 0.9em;
            opacity: 0.7;
            margin-bottom: 15px;
        }

        .question {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .choice {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 1em;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s ease;
        }

        .choice:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .choice.selected {
            border: 2px solid rgba(255, 215, 0, 0.8);
            background: rgba(255, 215, 0, 0.2);
        }

        .back-button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 20px;
        }

        .result {
            margin-bottom: 30px;
        }

        .emblem {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            margin: 0 auto 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 1.2em;
        }

        .hidden {
            display: none;
        }

        .disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            
            .title {
                font-size: 2em;
            }

            .data-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç”»é¢ -->
        <div id="loading" class="screen">
            <h1 class="title">ğŸŒ ã‚¯ã‚¤ã‚ºãƒ»ã‚ªã‚¿ã‚¯çŸ¥è­˜ã®æ³‰</h1>
            <div class="loading">
                <h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</h3>
                <p>768å•ã®æœ¬æ ¼ã‚¯ã‚¤ã‚ºãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™ä¸­ã§ã™</p>
                <div style="margin-top: 15px;">
                    <div id="loading-progress">æº–å‚™ä¸­...</div>
                </div>
            </div>
        </div>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ -->
        <div id="menu" class="screen hidden">
            <h1 class="title">ğŸŒ ã‚¯ã‚¤ã‚ºãƒ»ã‚ªã‚¿ã‚¯çŸ¥è­˜ã®æ³‰</h1>
            <p class="subtitle">ã‚ãªãŸã®ã‚ªã‚¿ã‚¯åº¦ã‚’æ¸¬å®šã—ã¾ã—ã‚‡ã†ï¼</p>
            
            <div class="stats">
                <h3>ğŸ“Š åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬æ ¼ç‰ˆï¼‰</h3>
                <div class="data-stats" id="data-stats">
                    <!-- ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
                <p><strong id="total-questions">åˆè¨ˆ: 0å•</strong></p>
            </div>

            <div class="difficulty-section">
                <h4>ğŸ¯ é›£æ˜“åº¦ã‚’é¸æŠ</h4>
                <div class="difficulty-buttons">
                    <button class="difficulty-button selected" data-difficulty="all">
                        å…¨é›£æ˜“åº¦
                    </button>
                    <button class="difficulty-button" data-difficulty="1">
                        â­ åˆç´š
                    </button>
                    <button class="difficulty-button" data-difficulty="2">
                        â­â­ ä¸­ç´š
                    </button>
                    <button class="difficulty-button" data-difficulty="3">
                        â­â­â­ ä¸Šç´š
                    </button>
                    <button class="difficulty-button" data-difficulty="4">
                        â­â­â­â­ è¶…ã‚ªã‚¿ã‚¯ç´š
                    </button>
                </div>
            </div>

            <div class="button-group">
                <button class="button random-button" onclick="startQuiz('random')">
                    ğŸ² å…¨ã‚·ãƒªãƒ¼ã‚ºã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œï¼ˆ10å•ï¼‰
                </button>
                <button class="button" onclick="startQuiz('ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹')">
                    ğŸ“º ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹
                </button>
                <button class="button" onclick="startQuiz('åƒ•ã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¢ã‚«ãƒ‡ãƒŸã‚¢')">
                    ğŸ“º åƒ•ã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¢ã‚«ãƒ‡ãƒŸã‚¢
                </button>
                <button class="button" onclick="startQuiz('HUNTERÃ—HUNTER')">
                    ğŸ“º HUNTERÃ—HUNTER
                </button>
            </div>
        </div>

        <!-- ã‚¯ã‚¤ã‚ºç”»é¢ -->
        <div id="quiz" class="screen hidden">
            <div class="quiz-header">
                <h2 id="quiz-title">ğŸ¯ ã‚¯ã‚¤ã‚º</h2>
                <div class="progress" id="progress">å•é¡Œ 1 / 10</div>
                <div class="question-meta" id="question-meta">é›£æ˜“åº¦: â­</div>
            </div>

            <div class="question">
                <h3 id="question-text">å•é¡Œæ–‡ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</h3>
            </div>

            <div class="choices" id="choices">
                <!-- é¸æŠè‚¢ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->
            </div>

            <div class="button-group">
                <button class="button disabled" id="next-button" onclick="nextQuestion()">
                    æ¬¡ã®å•é¡Œ
                </button>
            </div>

            <button class="back-button" onclick="showMenu()">
                ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹
            </button>
        </div>

        <!-- çµæœç”»é¢ -->
        <div id="results" class="screen hidden">
            <h2>ğŸ‰ ã‚¯ã‚¤ã‚ºçµæœ</h2>
            
            <div class="result">
                <div class="emblem" id="emblem">ğŸ†</div>
                <h3 id="level-title">çµæœ</h3>
                <p id="level-description">èª¬æ˜</p>
            </div>

            <div class="stats">
                <div class="stat-item">
                    <span>æ­£è§£ç‡:</span>
                    <span id="accuracy">0%</span>
                </div>
                <div class="stat-item">
                    <span>æ­£è§£æ•°:</span>
                    <span id="score">0/0</span>
                </div>
                <div class="stat-item">
                    <span>å¹³å‡é›£æ˜“åº¦:</span>
                    <span id="avg-difficulty">â­</span>
                </div>
            </div>

            <div class="button-group">
                <button class="button" onclick="showMenu()">
                    ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let allQuizData = {};
        let currentSeries = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let answers = [];
        let selectedAnswer = null;
        let selectedDifficulty = 'all';

        // ã‚ªã‚¿ã‚¯åº¦åˆ¤å®šãƒ‡ãƒ¼ã‚¿
        const otakuLevels = [
            { threshold: 95, level: 'god', title: 'ç¥', description: 'å®Œç’§ã™ãã‚‹...ã‚‚ã¯ã‚„äººé–“ã‚’è¶…è¶Šã—ã¦ã„ã‚‹ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ç•Œã®ç¥ã¨ã—ã¦å´‡ã‚ã‚‰ã‚Œã‚‹ã¹ãå­˜åœ¨ã§ã™ã€‚', color: '#FFD700', emblem: 'ğŸ‘‘' },
            { threshold: 90, level: 'legend', title: 'ç”Ÿã‘ã‚‹ä¼èª¬', description: 'ã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ç•Œã®ç”Ÿãå­—å¼•ã€‚ãã®çŸ¥è­˜ã®æ·±ã•ã«å‘¨å›²ã¯ç•æ•¬ã®å¿µã‚’æŠ±ãã¾ã™ã€‚', color: '#FF6B35', emblem: 'âš¡' },
            { threshold: 80, level: 'veteran', title: 'å¤å‚å…µ', description: 'é•·å¹´åŸ¹ã£ãŸçŸ¥è­˜ãŒå…‰ã‚‹ã€ç«‹æ´¾ãªå¤å‚ã‚ªã‚¿ã‚¯ã€‚æ–°å‚è€…ã®æ†§ã‚Œã®å­˜åœ¨ã§ã™ã€‚', color: '#8A2BE2', emblem: 'ğŸ›¡ï¸' },
            { threshold: 70, level: 'otaku-egg', title: 'ã‚ªã‚¿ã‚¯ã®åµ', description: 'ã‚ªã‚¿ã‚¯ã®ç‰‡é±—ã‚’è¦‹ã›ã¦ã„ã¾ã™ã€‚ã•ã‚‰ãªã‚‹æˆé•·ã«æœŸå¾…ãŒé«˜ã¾ã‚Šã¾ã™ï¼', color: '#4169E1', emblem: 'ğŸ¥š' },
            { threshold: 60, level: 'general', title: 'ä¸€èˆ¬äºº', description: 'ä¸€èˆ¬çš„ãªçŸ¥è­˜ãƒ¬ãƒ™ãƒ«ã€‚ã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ã«èˆˆå‘³ã¯ã‚ã‚‹ã‚ˆã†ã§ã™ã­ã€‚ã¾ã ã¾ã ä¼¸ã³ã—ã‚ãŒã‚ã‚Šã¾ã™ï¼', color: '#32CD32', emblem: 'ğŸ‘¤' },
            { threshold: 40, level: 'apprentice', title: 'è¦‹ç¿’ã„', description: 'è¦‹ç¿’ã„ãƒ¬ãƒ™ãƒ«ã€‚ã“ã‚Œã‹ã‚‰é ‘å¼µã‚Šã¾ã—ã‚‡ã†ï¼åŸºç¤ã‹ã‚‰å­¦ã³ç›´ã™ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚', color: '#FFA500', emblem: 'ğŸ“š' },
            { threshold: 0, level: 'newbie', title: 'ã«ã‚ã‹', description: 'ã¾ã ã¾ã ã“ã‚Œã‹ã‚‰ï¼ã‚‚ã£ã¨ã‚¢ãƒ‹ãƒ¡ãƒ»æ¼«ç”»ã®ä¸–ç•Œã«è§¦ã‚Œã¦çŸ¥è­˜ã‚’æ·±ã‚ã¾ã—ã‚‡ã†ã€‚', color: '#DC143C', emblem: 'ğŸŒ±' }
        ];

        // CSVè§£æé–¢æ•°
        function parseCSV(csvText) {
            const lines = csvText.split('\n').filter(line => line.trim());
            const questions = [];
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦é–‹å§‹
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const columns = line.split(',');
                if (columns.length >= 12) {
                    questions.push({
                        id: columns[3],
                        category: columns[0],
                        series: columns[1],
                        subcategory: columns[2],
                        text: columns[4],
                        choices: [columns[5], columns[6], columns[7], columns[8]],
                        correct: parseInt(columns[9]) - 1, // CSV is 1-indexed, convert to 0-indexed
                        explanation: columns[10],
                        difficulty: parseInt(columns[11])
                    });
                }
            }
            
            return questions;
        }

        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadAllData() {
            const files = [
                { name: 'ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹', path: 'specifications/data/quiz/ãƒ¯ãƒ³ãƒ”ãƒ¼ã‚¹.csv' },
                { name: 'åƒ•ã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¢ã‚«ãƒ‡ãƒŸã‚¢', path: 'specifications/data/quiz/åƒ•ã®ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¢ã‚«ãƒ‡ãƒŸã‚¢.csv' },
                { name: 'HUNTERÃ—HUNTER', path: 'specifications/data/quiz/HUNTERÃ—HUNTER.csv' }
            ];

            document.getElementById('loading-progress').textContent = 'CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...';

            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                try {
                    document.getElementById('loading-progress').textContent = `${file.name}ã‚’èª­ã¿è¾¼ã¿ä¸­... (${i + 1}/${files.length})`;
                    
                    const response = await fetch(file.path);
                    const csvText = await response.text();
                    const questions = parseCSV(csvText);
                    
                    allQuizData[file.name] = questions;
                    console.log(`Loaded ${questions.length} questions from ${file.name}`);
                } catch (error) {
                    console.error(`Failed to load ${file.name}:`, error);
                    allQuizData[file.name] = [];
                }
            }

            document.getElementById('loading-progress').textContent = 'ãƒ‡ãƒ¼ã‚¿å‡¦ç†å®Œäº†ï¼';
            setTimeout(() => {
                showMenu();
                displayDataStats();
            }, 500);
        }

        // ãƒ‡ãƒ¼ã‚¿çµ±è¨ˆè¡¨ç¤º
        function displayDataStats() {
            const statsContainer = document.getElementById('data-stats');
            let totalQuestions = 0;

            statsContainer.innerHTML = '';

            Object.keys(allQuizData).forEach(series => {
                const count = allQuizData[series].length;
                totalQuestions += count;

                const statCard = document.createElement('div');
                statCard.className = 'stat-card';
                statCard.innerHTML = `
                    <div>ğŸ“º ${series}</div>
                    <div class="stat-number">${count}</div>
                    <div>å•</div>
                `;
                statsContainer.appendChild(statCard);
            });

            document.getElementById('total-questions').textContent = `åˆè¨ˆ: ${totalQuestions}å•`;
        }

        // ç”»é¢è¡¨ç¤ºåˆ¶å¾¡
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function showMenu() {
            showScreen('menu');
            resetGame();
        }

        function resetGame() {
            currentSeries = '';
            currentQuestions = [];
            currentQuestionIndex = 0;
            answers = [];
            selectedAnswer = null;
        }

        // é›£æ˜“åº¦é¸æŠ
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('difficulty-button')) {
                document.querySelectorAll('.difficulty-button').forEach(btn => {
                    btn.classList.remove('selected');
                });
                e.target.classList.add('selected');
                selectedDifficulty = e.target.dataset.difficulty;
            }
        });

        // ã‚¯ã‚¤ã‚ºé–‹å§‹
        function startQuiz(series) {
            currentSeries = series;
            
            let availableQuestions = [];
            
            if (series === 'random') {
                // å…¨ã‚·ãƒªãƒ¼ã‚ºã‹ã‚‰å–å¾—
                Object.values(allQuizData).forEach(questions => {
                    availableQuestions.push(...questions);
                });
            } else {
                availableQuestions = [...allQuizData[series]];
            }

            // é›£æ˜“åº¦ãƒ•ã‚£ãƒ«ã‚¿
            if (selectedDifficulty !== 'all') {
                const targetDifficulty = parseInt(selectedDifficulty);
                availableQuestions = availableQuestions.filter(q => q.difficulty === targetDifficulty);
            }

            if (availableQuestions.length === 0) {
                alert('é¸æŠã—ãŸæ¡ä»¶ã«è©²å½“ã™ã‚‹å•é¡ŒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }

            // ãƒ©ãƒ³ãƒ€ãƒ ã«10å•é¸æŠ
            currentQuestions = shuffleArray(availableQuestions).slice(0, 10);
            currentQuestionIndex = 0;
            answers = [];
            
            showScreen('quiz');
            displayQuestion();
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            const difficultyStars = 'â­'.repeat(question.difficulty);
            
            document.getElementById('quiz-title').textContent = `ğŸ¯ ${currentSeries}ã‚¯ã‚¤ã‚º`;
            document.getElementById('progress').textContent = `å•é¡Œ ${currentQuestionIndex + 1} / ${currentQuestions.length}`;
            document.getElementById('question-meta').textContent = `${question.series} - ${question.subcategory} - é›£æ˜“åº¦: ${difficultyStars}`;
            document.getElementById('question-text').textContent = question.text;
            
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';
            
            question.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice';
                button.textContent = `${index + 1}. ${choice}`;
                button.onclick = () => selectAnswer(index);
                choicesContainer.appendChild(button);
            });
            
            selectedAnswer = null;
            updateNextButton();
        }

        function selectAnswer(answerIndex) {
            selectedAnswer = answerIndex;
            
            document.querySelectorAll('.choice').forEach((choice, index) => {
                choice.classList.toggle('selected', index === answerIndex);
            });
            
            updateNextButton();
        }

        function updateNextButton() {
            const nextButton = document.getElementById('next-button');
            if (selectedAnswer !== null) {
                nextButton.classList.remove('disabled');
                nextButton.textContent = currentQuestionIndex < currentQuestions.length - 1 ? 'æ¬¡ã®å•é¡Œ' : 'çµæœã‚’è¦‹ã‚‹';
            } else {
                nextButton.classList.add('disabled');
            }
        }

        function nextQuestion() {
            if (selectedAnswer === null) return;
            
            const question = currentQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            answers.push({
                questionId: question.id,
                selectedAnswer: selectedAnswer,
                isCorrect: isCorrect,
                difficulty: question.difficulty
            });
            
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            const correctCount = answers.filter(a => a.isCorrect).length;
            const totalCount = answers.length;
            const accuracy = Math.round((correctCount / totalCount) * 100);
            
            // å¹³å‡é›£æ˜“åº¦è¨ˆç®—
            const avgDifficulty = answers.reduce((sum, a) => sum + a.difficulty, 0) / answers.length;
            const avgDifficultyStars = 'â­'.repeat(Math.round(avgDifficulty));
            
            // ã‚ªã‚¿ã‚¯åº¦è¨ˆç®—ï¼ˆé›£æ˜“åº¦ã‚‚è€ƒæ…®ï¼‰
            const otakuLevel = calculateOtakuLevel(accuracy, avgDifficulty);
            
            document.getElementById('emblem').textContent = otakuLevel.emblem;
            document.getElementById('emblem').style.backgroundColor = otakuLevel.color;
            document.getElementById('level-title').textContent = otakuLevel.title;
            document.getElementById('level-title').style.color = otakuLevel.color;
            document.getElementById('level-description').textContent = otakuLevel.description;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('score').textContent = `${correctCount}/${totalCount}`;
            document.getElementById('avg-difficulty').textContent = avgDifficultyStars;
            
            showScreen('results');
        }

        function calculateOtakuLevel(accuracy, avgDifficulty) {
            // é›£æ˜“åº¦ãƒœãƒ¼ãƒŠã‚¹ã‚’åŠ ç®—
            const bonusScore = accuracy + (avgDifficulty * 5);
            
            for (let level of otakuLevels) {
                if (bonusScore >= level.threshold) {
                    return level;
                }
            }
            return otakuLevels[otakuLevels.length - 1];
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            showScreen('loading');
            loadAllData();
        });
    </script>
</body>
</html>